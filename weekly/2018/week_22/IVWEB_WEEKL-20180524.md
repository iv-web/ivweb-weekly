## 文章索引
1、 <a href="#1rxjs-6发布改进了性能和模块化" >RxJS 6发布，改进了性能和模块化</a><br/>
2、 <a href="#2谷歌使用androidx代替android支持库" >谷歌使用AndroidX代替Android支持库</a><br/>
3、 <a href="#3视频访谈-安静波基于原生云架构的呼叫中心实践" >视频访谈： 安静波：基于原生云架构的呼叫中心实践</a><br/>
4、 <a href="#4文章-当我们聊技术实力的时候我们到底在聊什么" >文章： 当我们聊技术实力的时候，我们到底在聊什么</a><br/>
5、 <a href="#5迈入游戏开发的门槛真的有那么高" >迈入游戏开发的门槛真的有那么高？</a><br/>
6、 <a href="#6谷歌通过定制的深度学习模型升级了其语音转文字的服务" >谷歌通过定制的深度学习模型升级了其语音转文字的服务</a><br/>
7、 <a href="#7github-checks-api帮助应用实现进一步的持续集成" >GitHub Checks API帮助应用实现进一步的持续集成</a><br/>
8、 <a href="#8视频访谈-张夏混合云是未来的主流并将持续存在" >视频访谈： 张夏：混合云是未来的主流，并将持续存在</a><br/>
9、 <a href="#9azure-machine-learning的新特性" >Azure Machine Learning的新特性</a><br/>
10、 <a href="#10visual-studio-2017-157全面支持c++17" >Visual Studio 2017 15.7全面支持C++17</a><br/>
11、 <a href="#11美国银行发布区块链数据存储专利" >美国银行发布区块链数据存储专利</a><br/>
12、 <a href="#12ee4j项目情况汇总微软加入jakarta-ee工作组" >EE4J项目情况汇总，微软加入Jakarta EE工作组</a><br/>
13、 <a href="#13文章-在kubernetes上运行可伸缩工作负载的六个技巧" >文章： 在Kubernetes上运行可伸缩工作负载的六个技巧</a><br/>
14、 <a href="#14creating-the-feature-queries-manager-devtools-extension" >Creating The Feature Queries Manager DevTools Extension</a><br/><h1 id="#title_0" >1、RxJS 6发布，改进了性能和模块化</h1>
Dylan Schiemann
[http://www.infoq.com/cn/news/2018/05/rxjs-6-released?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/rxjs-6-released?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>RxJS团队宣布RxJS 6.0发布。6.0改进了模块化方法和平滑迁移性能、为简化升级而添加了反向兼容软件包，并为TypeScript用户提供了代码迁移。</p> <i>By Dylan Schiemann</i> <i> Translated by 盖磊</i>
---------------
<h1 id="#title_1" >2、谷歌使用AndroidX代替Android支持库</h1>
Sergio De Simone
[http://www.infoq.com/cn/news/2018/05/androidx-library-alpha?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/androidx-library-alpha?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>新的Android扩展库（AndroidX）取代了使用七年之久的Android支持库，旨在简化相关工作，并为该库未来的发展打下坚实的基础。

</p> <i>By Sergio De Simone</i> <i> Translated by 谢丽</i>
---------------
<h1 id="#title_2" >3、视频访谈： 安静波：基于原生云架构的呼叫中心实践</h1>
安静波
[http://www.infoq.com/cn/interviews/interview-with-anjingbo-talk-call-center?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/interviews/interview-with-anjingbo-talk-call-center?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="https://res.infoq.com/interviews/interview-with-anjingbo-talk-call-center/zh/mediumimage/anjingbo270-1527092861326.jpg"/><p>我们在QCon 全球软件开发大会，2018北京站的现场，很荣幸地采访到了来自天润融通的总服务架构师安静波先生，请他来谈谈天润融通在原生云架构呼叫中心的实践与发展。</p> <i>By 安静波</i>
---------------
<h1 id="#title_3" >4、文章： 当我们聊技术实力的时候，我们到底在聊什么</h1>
李运华
[http://www.infoq.com/cn/articles/talk-about-technology?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/articles/talk-about-technology?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="https://res.infoq.com/articles/talk-about-technology/zh/smallimage/logo-1527062362564.jpeg"/><p>当我们聊技术实力的时候，我们到底在聊什么？</p> <i>By 李运华</i>
---------------
<h1 id="#title_4" >5、迈入游戏开发的门槛真的有那么高？</h1>
蔡能
[http://www.infoq.com/cn/news/2018/05/game-develop-entry-barrier?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/game-develop-entry-barrier?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>如果你想入门游戏开发，我希望让你对游戏开发有实质性的掌握，对游戏的开发和理念有完整且系统的了解，并且能很快地着手进行游戏的开发。</p> <i>By 蔡能</i>
---------------
<h1 id="#title_5" >6、谷歌通过定制的深度学习模型升级了其语音转文字的服务</h1>
Alexis Perrier
[http://www.infoq.com/cn/news/2018/05/google-speech-to-text-api?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/google-speech-to-text-api?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>一个月前，谷歌宣布在文字转语音（Text-to-Speech，简称TTS）技术上取得代际突破，接着该公司又对其语音转文字（Speech-to-Text，简称STT）API云服务进行了重大升级。更新后的服务利用语音转录的深度学习模型，根据特定用例量身定制：短语音命令、打电话或视频，还包括给转录文本添加标点符号。</p> <i>By Alexis Perrier</i> <i> Translated by 姚佳灵</i>
---------------
<h1 id="#title_6" >7、GitHub Checks API帮助应用实现进一步的持续集成</h1>
Sergio De Simone
[http://www.infoq.com/cn/news/2018/05/github-checks-api?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/github-checks-api?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>GitHub Checks API意在实现向持续集成工作流中添加代码检查，诸如对源代码文件做Lint静态分析后，将结果直接展示在PULL请求视图中。反馈信息可达用户预期的详细程度，包括给出导致问题的代码行，使得代码提交者可以修复问题，并在代码上运行新的检查。

</p> <i>By Sergio De Simone</i> <i> Translated by 盖磊</i>
---------------
<h1 id="#title_7" >8、视频访谈： 张夏：混合云是未来的主流，并将持续存在</h1>
张夏
[http://www.infoq.com/cn/interviews/interview-with-zhangxia-talk-hybrid-cloud?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/interviews/interview-with-zhangxia-talk-hybrid-cloud?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="https://res.infoq.com/interviews/interview-with-zhangxia-talk-hybrid-cloud/zh/mediumimage/zhangxia270-1526805724659.jpg"/><p>我们在QCon 全球软件开发大会，2018北京站的现场，很荣幸地采访到了来自FreeWheel的主任工程师张夏先生，请他来谈谈混合云平台部署的相关技术和发展前景。</p> <i>By 张夏</i>
---------------
<h1 id="#title_8" >9、Azure Machine Learning的新特性</h1>
Michael Stiefel
[http://www.infoq.com/cn/news/2018/05/Azure-Machine-Learning-New?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/Azure-Machine-Learning-New?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>在Microsoft Build 2018大会上，Matt Winkler做演讲介绍了Azure Machine Learing的新特性。Azure ML的新特性涉及多个方面，包括简化开发、单容器部署以加速开发-测试循环、使用Azure Notebook提供的SDK实现控制，以及帮助人们着手解决一些特定的问题。</p> <i>By Michael Stiefel</i> <i> Translated by 盖磊</i>
---------------
<h1 id="#title_9" >10、Visual Studio 2017 15.7全面支持C++17</h1>
Jeff Martin
[http://www.infoq.com/cn/news/2018/05/vs2017-157?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/vs2017-157?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>微软发布了Visual Studio 2017的第7个更新。值得注意的新特性包括：全面支持C++17、经过改进的安装器、大多数开发人员都可以从中获益的开发体验改善。</p> <i>By Jeff Martin</i> <i> Translated by 谢丽</i>
---------------
<h1 id="#title_10" >11、美国银行发布区块链数据存储专利</h1>
Kent Weare
[http://www.infoq.com/cn/news/2018/05/BOA-Blockchain-Storage-Patent?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/BOA-Blockchain-Storage-Patent?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>4月12日，美国专利和商标局（USPTO）发布了美国银行的一项专利申请，概述了已经获批的允许个人和商业共享数据的区块链实施计划。用户将授权服务提供商安全地访问他们的数据，但仅限于他们有权访问的特定记录。</p> <i>By Kent Weare</i> <i> Translated by 无明</i>
---------------
<h1 id="#title_11" >12、EE4J项目情况汇总，微软加入Jakarta EE工作组</h1>
Michael Redlich
[http://www.infoq.com/cn/news/2018/05/latest-ee4j-activities?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/news/2018/05/latest-ee4j-activities?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="http://www.infoq.com/styles/i/logo_bigger.jpg"/><p>由于Eclipse基金会将Jakarta EE定位为云原生Java的新家，最近出现了一系列EE4J活动。许多EE4J项目处于提议、创建或创建评审阶段，微软已加入Jakarta EE工作组。</p> <i>By Michael Redlich</i> <i> Translated by 无明</i>
---------------
<h1 id="#title_12" >13、文章： 在Kubernetes上运行可伸缩工作负载的六个技巧</h1>
Joel Speed
[http://www.infoq.com/cn/articles/tips-running-scalable-workloads-kubernetes?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global](http://www.infoq.com/cn/articles/tips-running-scalable-workloads-kubernetes?utm_campaign=infoq_content&utm_source=infoq&utm_medium=feed&utm_term=global)
<img src="https://res.infoq.com/articles/tips-running-scalable-workloads-kubernetes/zh/smallimage/Logo-7-1522357937099.jpg"/><p>这些技巧可以确保Kubernetes知道你在部署过程中发生了什么：譬如调度在哪里最好，知道什么时候可以开始处理请求，并确保工作负载在尽可能多的节点上传播。</p> <i>By Joel Speed</i> <i> Translated by 陈亮芬</i>
---------------
<h1 id="#title_13" >14、Creating The Feature Queries Manager DevTools Extension</h1>
Ire Aderinokun
[https://www.smashingmagazine.com/2018/05/feature-queries-manager-devtools-extension/](https://www.smashingmagazine.com/2018/05/feature-queries-manager-devtools-extension/)
<html>
            <head>
              <meta charset="utf-8">
              <link rel="canonical" href="https://www.smashingmagazine.com/2018/05/feature-queries-manager-devtools-extension/" />
              <title>Creating The Feature Queries Manager DevTools Extension</title>
            </head>
            <body>
              <article>
                <header>
                  <h1>Creating The Feature Queries Manager DevTools Extension</h1>
                  
                    
                    <address>Ire Aderinokun</address>
                  
                  <time datetime="2018-05-23T12:00:00&#43;02:00" class="op-published">2018-05-23T12:00:00+02:00</time>
                  <time datetime="2018-05-23T13:42:58&#43;00:00" class="op-modified">2018-05-23T13:42:58+00:00</time>
                </header>
                

<p>Within the past couple of years, several game-changing CSS features have been rolled out to the major browsers. CSS Grid Layout, for example, went from 0 to 80% global support within the span of a few months, making it an incredibly useful and reliable tool in our arsenal. Even though the current support for a feature like CSS Grid Layout is relatively great, not all recent or current browsers support it. This means it’s very likely that you and I will currently be developing for a browser in which it is not supported.</p>

<p>The modern solution to developing for both modern and legacy browsers is feature queries. They allow us to write CSS that is conditional on browser support for a particular feature. Although working with feature queries is almost magical, testing them can be a pain. Unlike media queries, we can’t easily simulate the different states by just resizing the browser. That’s where the  comes in, an extension to DevTools to help you easily toggle your feature query conditions. In this article, I will cover how I built this extension, as well as give an introduction to how developer tools extensions are built.</p>

<h3 id="working-with-unsupported-css">Working With Unsupported CSS</h3>

<p>If a <code>property-value</code> pair (e.g. <code>display: grid</code>), is not supported by the browser the page is viewed in, not much happens. Unlike other programming languages, if something is broken or unsupported in CSS, it only affects the broken or unsupported rule, leaving everything else around it intact.</p>



  <aside class="product-panel product-panel__tilted product-panel--book" data-audience="non-subscriber">
    <div class="container product-panel--book__container">
      <div class="panel__description panel__description--book">
    <p>Getting the process <em>just</em> right ain't an easy task. That's why we've set up <strong>'this-is-how-I-work'-sessions</strong> — with smart cookies sharing what works really well for them. A part of the , of course.</p>
      <a href="https://www.smashingmagazine.com/membership/" class="btn btn--green btn--large">
        Explore features&nbsp;→
      </a>
      </div>
      <div class="panel__image panel__image--book">
        <a href="https://www.smashingmagazine.com/membership/" class="books__book__image">
        <div class="books__book__img">
          <img src="https://www.smashingmagazine.com/images/smashing-cat/cat-scubadiving-panel.svg" alt="Smashing TV, with live sessions for professional designers and developers." width="310" height="400">
        </div>
      </a>
      </div>
    </div>
  </aside>





<div class="c-garfield-the-cat">


<p>Let’s take, for example, this simple layout:</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/81476cba-474b-46ca-a99f-0970db3c3dbf/layout-supported.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/81476cba-474b-46ca-a99f-0970db3c3dbf/layout-supported.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/81476cba-474b-46ca-a99f-0970db3c3dbf/layout-supported.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/81476cba-474b-46ca-a99f-0970db3c3dbf/layout-supported.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/81476cba-474b-46ca-a99f-0970db3c3dbf/layout-supported.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/81476cba-474b-46ca-a99f-0970db3c3dbf/layout-supported.png"
			sizes="100vw"
			alt="The layout in a supporting browser"
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>


<p>We have a header spanning across the top of the page, a main section directly below that to the left, a sidebar to the right, and a footer spanning across the bottom of the page.</p>

<p>Here’s how we could create this layout using CSS Grid:</p>

<p data-height="500"
   data-theme-id="light"
   data-slug-hash="mLmXOK"
   data-user="ire"
   data-default-tab="result"
   class='codepen'>See the Pen .</p>


<p>In a supporting browser like Chrome, this works just as we want. But if we were to view this same page in a browser that doesn&rsquo;t support CSS Grid Layout, this is what we would get:</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/3c4dc2e1-f7be-40ce-ada6-0b7d495add17/layout-unsupported.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/3c4dc2e1-f7be-40ce-ada6-0b7d495add17/layout-unsupported.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/3c4dc2e1-f7be-40ce-ada6-0b7d495add17/layout-unsupported.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/3c4dc2e1-f7be-40ce-ada6-0b7d495add17/layout-unsupported.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/3c4dc2e1-f7be-40ce-ada6-0b7d495add17/layout-unsupported.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/3c4dc2e1-f7be-40ce-ada6-0b7d495add17/layout-unsupported.png"
			sizes="100vw"
			alt="The layout in an unsupporting browser "
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>


<p>It is essentially the same as if we had not applied any of the grid-related styles in the first place. This behavior of CSS was always intentional. In the , it says:</p>

<blockquote>
<p>In some cases, user agents must ignore part of an illegal style sheet, [which means to act] as if it had not been there</p>
</blockquote>

<p>Historically, the best way to handle this has been to make use of the cascading nature of CSS. According to the specification, “the last declaration in document order wins.” This means that if there are multiple of the same property being defined within a single declaration block, the latter prevails.</p>

<p>For example, if we have the follow declarations:</p>

<pre><code class="language-css">body {
  display: flex;
  display: grid;
}
</code></pre>

<p>Assuming both Flexbox and Grid are supported in the browser, the latter &mdash; <code>display: grid</code> &mdash; will prevail. But if Grid is <em>not</em> supported by the browser, then that rule is ignored, and any previous valid and supported rules, in this case <code>display: flex</code>, are used instead.</p>

<pre><code class="language-css">body {
  display: flex;</code>
  <code class="language-css" style="text-decoration: line-through;">display: grid;</code>
<code class="language-css">}
</code></pre>

<h4 id="cascading-problems">Cascading Problems</h4>

<p>Using the cascade as a method for progressive enhancement is and has always been incredibly useful. Even today, there is no simpler or better way to handle simple one-liner fallbacks, such as this one for applying a solid colour where the <code>rgba()</code> syntax is not supported.</p>

<pre><code class="language-css">div {
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.5);
}
</code></pre>

<p>Using the cascade, however, has one major limitation, which comes into play when we have multiple, dependent CSS rules. Let’s again take the layout example. If we were to attempt to use this cascade technique to create a fallback, we would end up with competing CSS rules.</p>

<p data-height="500"
   data-theme-id="light"
   data-slug-hash="odWVBJ"
   data-user="ire"
   data-default-tab="result"
   class='codepen'>See the Pen .</p>


<p>In the fallback solution, we need to use certain properties such as margins and widths, that aren&rsquo;t needed and in fact interfere with the “enhanced” Grid version. This makes it difficult to rely on the cascade for more complex progressive enhancement.</p>

<h4 id="feature-queries-to-the-rescue">Feature Queries To The Rescue!</h4>


  <div id="sponsors-article" data-impression="true" class="c-promo-box c-promo-box--ad sponsors hidden" data-audience="non-subscriber" data-remove="true"></div>



<p>Feature queries solve the problem of needing to apply groups of styles that are dependent on the support of a CSS feature. Feature queries are a &ldquo;nested at-rule&rdquo; which, like the media queries we are used to, allow us to create a subset of CSS declarations that are applied based on a condition. Unlike media queries, whose condition is dependent on device and screen specs, feature query conditions are instead based on if the browser supports a given property-value pair.</p>

<p>A feature query is made up of three parts:</p>

<ol>
<li>The <code>@supports</code> keyword</li>
<li>The condition, e.g. <code>display: flex</code></li>
<li>The nested CSS declarations.</li>
</ol>

<p>Here is how it looks:</p>

<pre><code class="language-css">@supports (display: grid) {
    body { display: grid; }
}
</code></pre>

<p>If the browser supports <code>display: grid</code>, then the nested styles will apply. If the browser does not support <code>display: grid</code>, then the block is skipped over entirely.</p>

<p>The above is an example of a <em>positive</em> condition within a feature query, but there are four flavors of feature queries:</p>

<ol>
<li><p>Positive condition, e.g. <code>@supports (display grid)</code></p></li>

<li><p>Negative condition, e.g. <code>@supports not (display: grid)</code></p></li>

<li><p>Conjunction, e.g. <code>@supports (display:flex) and (display: grid)</code></p></li>

<li><p>Disjunction, e.g. <code>@supports (display:-ms-grid) or (display: grid)</code></p></li>
</ol>

<p>Feature queries solve the problem of having separate fallback and enhancement groups of styles. Let’s see how we can apply this to our example layout:</p>

<p data-height="500"
   data-theme-id="light"
   data-slug-hash="mLmopd"
   data-user="ire"
   data-default-tab="result"
   class='codepen'>See the Pen .</p>


<h3 id="introducing-the-feature-queries-manager">Introducing The Feature Queries Manager</h3>

<p><blockuote>When we write media queries, we test them by resizing our browser so that the styles at each breakpoint apply. So how do we test feature queries?</blockuote></p>

<p>Since feature queries are dependent on whether a browser supports a feature, there is no easy way to simulate the alternative state. Currently, the only way to do this would be to edit your code to invalidate/reverse the feature query.</p>

<p>For example, if we wanted to simulate a state in which CSS Grid is not supported, we would have to do something like this:</p>

<pre><code class="language-css">/* fallback styles here */

@supports (display: grrrrrrrrid) {
    /* enhancement styles here */
}
</code></pre>

<p>This is where the Feature Queries Manager comes in. It is a way to reverse your feature queries without ever having to manually edit your code.</p>

<figure>)</figcaption></figure>

<p>It works by simply negating the feature query as it is written. So the following feature query:</p>

<pre><code class="language-css">@supports (display: grid) {
    body { display: grid; }
}
</code></pre>

<p>Will become the following:</p>

<pre><code class="language-css">@supports not (display: grid) {
    body { display: grid; }
}
</code></pre>

<p>Fun fact, this method works for negative feature queries as well. For example, the following negative feature query:</p>

<pre><code class="language-css">@supports not (display: grid) {
    body { display: block; }
}
</code></pre>

<p>Will become the following:</p>

<pre><code class="language-css">@supports not (not (display: grid)) {
    body { display: block; }
}
</code></pre>

<p>Which is actually essentially the same as removing the “not” from the feature query.</p>

<pre><code class="language-css">@supports (display: grid) {
    body { display: block; }
}
</code></pre>

<h3 id="building-the-feature-queries-manager">Building The Feature Queries Manager</h3>

<p>FQM is an extension to your browser’s Developer Tools. It works by registering all the CSS on a page, filtering out the CSS that is nested within a feature query, and giving us the ability to toggle the normal or &ldquo;inverted&rdquo; version of that feature query.</p>

<h4 id="creating-a-devtools-panel">Creating A DevTools Panel</h4>

<p>Before I go on to how I specifically built the FQM, let’s cover how to create a new DevTools panel in the first place.  Like any other browser extension, we register a DevTools extension with the manifest file.</p>

<pre><code class="language-css">{
  "manifest_version": 2,
  "name": "Feature Queries Manager",
  "short_name": "FQM",
  "description": "Manage and toggle CSS on a page behind a @supports Feature Query.",
  "version": "0.1",
  "permissions": [
    "tabs",
    "activeTab",
    "&lt;all_urls&gt;"
  ],
  "icons": {
    "128": "images/icon@128.png",
    "64": "images/icon@64.png",
    "16": "images/icon@16.png",
    "48": "images/icon@48.png"
  }
}
</code></pre>

<p>To create a new panel in DevTools, we need two files &mdash; a <code>devtools_page</code>, which is an HTML page with an attached script that registers the second file, <code>panel.html</code>, which controls the actual panel in DevTools.</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6536506-051b-4c21-8c50-b33b82fc1517/create-devtools.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6536506-051b-4c21-8c50-b33b82fc1517/create-devtools.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6536506-051b-4c21-8c50-b33b82fc1517/create-devtools.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6536506-051b-4c21-8c50-b33b82fc1517/create-devtools.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6536506-051b-4c21-8c50-b33b82fc1517/create-devtools.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6536506-051b-4c21-8c50-b33b82fc1517/create-devtools.png"
			sizes="100vw"
			alt="The devtools script creates the panel page"
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>


<p>First, we add the <code>devtools_page</code> to our manifest file:</p>

<pre><code class="language-css">{
  "manifest_version": 2,
  "name": "Feature Queries Manager",
  ...
  "devtools_page": "devtools.html",
}
</code></pre>

<p>Then, in our <code>devtools.html</code> file, we create a new panel in DevTools:</p>

<pre><code class="language-html">&lt;!DOCTYPE html>
&lt;html>
&lt;head>
  &lt;meta charset="utf-8">&lt;/head>
&lt;body>
&lt;!-- Note: I’m using the browser-polyfill to be able to use the Promise-based WebExtension API in Chrome -->
&lt;script src="../browser-polyfill.js">&lt;/script>

&lt;!-- Create FQM panel -->
&lt;script>
browser.devtools.panels.create("FQM", "images/icon@64.png", "panel.html");
&lt;/script>
&lt;/body>
&lt;/html
</code></pre>

<p>Finally, we create our panel HTML page:</p>

<pre><code class="language-html">&lt;!DOCTYPE html>
&lt;html>
&lt;head>
  &lt;meta charset="utf-8">&lt;/head>
&lt;body>
  &lt;h1>Hello, world!&lt;/h1>
&lt;/body>
&lt;/html>
</code></pre>

<p>If we open up our browser, we will see a new panel called &ldquo;FQM&rdquo; which loads the <code>panel.html</code> page.</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/39b55a23-bdaa-44de-8d43-2c6b853c0398/new-panel.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/39b55a23-bdaa-44de-8d43-2c6b853c0398/new-panel.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/39b55a23-bdaa-44de-8d43-2c6b853c0398/new-panel.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/39b55a23-bdaa-44de-8d43-2c6b853c0398/new-panel.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/39b55a23-bdaa-44de-8d43-2c6b853c0398/new-panel.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/39b55a23-bdaa-44de-8d43-2c6b853c0398/new-panel.png"
			sizes="100vw"
			alt="A new panel in browser DevTools showing the “Hello, World” text"
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>





  <aside class="product-panel product-panel__tilted product-panel--book" data-audience="non-subscriber" data-remove="true">
    <div class="container product-panel--book__container">
      <div class="panel__description panel__description--book">
        <p>
          Is your pattern library up to date today? <em>Alla Kholmatova</em> has just finished a fully fledged book on <strong>Design Systems</strong> and how to get them right. With common traps, gotchas and the lessons she learned. Hardcover, eBook. <em>Just sayin'.</em>
        </p>
        <a href="https://www.smashingmagazine.com/printed-books/design-systems/">
          <button class="btn btn--green btn--large">
            Table of Contents&nbsp;&rarr;
          </button>
        </a>
      </div>
      <div class="panel__image panel__image--book">
        <a href="https://www.smashingmagazine.com/printed-books/design-systems/" class="books__book__image">
        <div class="books__book__img">
          <img src="https://www.smashingmagazine.com/images/books/design-systems--large-opt.png">
        </div>
      </a>
      </div>
    </div>
  </aside>




<h4 id="reading-css-from-the-inspected-page">Reading CSS From The Inspected Page</h4>

<p>In the FQM, we need to access all the CSS referenced in the inspected document in order to know which are within feature queries. However, our DevTools panel doesn&rsquo;t have direct access to anything on the page. If we want access to the inspected document, we need a content script.</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2acea555-043d-4195-b112-12541b7f9d5e/content.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2acea555-043d-4195-b112-12541b7f9d5e/content.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2acea555-043d-4195-b112-12541b7f9d5e/content.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2acea555-043d-4195-b112-12541b7f9d5e/content.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2acea555-043d-4195-b112-12541b7f9d5e/content.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2acea555-043d-4195-b112-12541b7f9d5e/content.png"
			sizes="100vw"
			alt="The content script reads CSS from the HTML document"
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>


<p>A content script is a javascript file that has the same access to the html page as any other piece of javascript embedded within it. To register a content script, we just add it to our manifest file:</p>

<pre><code class="language-javascript">{
      "manifest_version": 2,
      "name": "Feature Queries Manager",
      ...
      "content_scripts": [{
        "matches": ["<all_urls>"],
        "js": ["browser-polyfill.js", "content.js"]
      }],
    }

</code></pre>

<p>In our content script, we can then read all the stylesheets and css within them by accessing  <code>document.styleSheets</code>:</p>

<pre><code class="language-javascript">Array.from(document.styleSheets).forEach((stylesheet) => {
      let cssRules;
      
      try {
        cssRules = Array.from(stylesheet.cssRules);
      } catch(err) {
        return console.warn(`[FQM] Can't read cssRules from stylesheet: ${ stylesheet.href }`);
      }
      
      cssRules.forEach((rule, i) => {
      
        /* Check if css rule is a Feature Query */
        if (rule instanceof CSSSupportsRule) {
          /* do something with the css rule */
        }
        
      });
    });
</code></pre>

<h4 id="connecting-the-panel-and-the-content-scripts">Connecting The Panel And The Content Scripts</h4>

<p>Once we have the rules from the content script, we want to send them over to the panel so they can be visible there. Ideally, we would want something like this:</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b12bc866-43cb-4100-b623-60b24b61ba83/panel-content.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b12bc866-43cb-4100-b623-60b24b61ba83/panel-content.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b12bc866-43cb-4100-b623-60b24b61ba83/panel-content.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b12bc866-43cb-4100-b623-60b24b61ba83/panel-content.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b12bc866-43cb-4100-b623-60b24b61ba83/panel-content.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b12bc866-43cb-4100-b623-60b24b61ba83/panel-content.png"
			sizes="100vw"
			alt="The content script passes information to the panel and the panel sends instructions to modify CSS back to the content"
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>


<p>However, we can&rsquo;t exactly do this, because the panel and content files can&rsquo;t actually talk directly to each other. To pass information between these two files, we need a middleman &mdash; a background script. The resulting connection looks something like this:</p>











<figure >
	
		<img
			srcset="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7376096e-143b-4bb5-81e9-12d8533354f5/panel-background-content.png 400w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_800/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7376096e-143b-4bb5-81e9-12d8533354f5/panel-background-content.png 800w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1200/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7376096e-143b-4bb5-81e9-12d8533354f5/panel-background-content.png 1200w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_1600/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7376096e-143b-4bb5-81e9-12d8533354f5/panel-background-content.png 1600w,
			        https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_2000/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7376096e-143b-4bb5-81e9-12d8533354f5/panel-background-content.png 2000w"
			src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_auto/w_400/https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7376096e-143b-4bb5-81e9-12d8533354f5/panel-background-content.png"
			sizes="100vw"
			alt="The content and panel scripts communicate via a background script"
		/>
	

	
		<figcaption class="op-vertical-bottom">
			
		</figcaption>
	
</figure>


<p>As always, to register a background script, we need to add it to our manifest file:</p>

<pre><code class="language-css">{
  "manifest_version": 2,
  "name": "Feature Queries Manager",
  ...
  "background": {
    "scripts": ["browser-polyfill.js", "background.js"]
  },
}
</code></pre>

<p>The background file will need to open up a connection to the panel script and listens for messages coming from there. When the background file receives a message from the panel, it passes it on to the content script, which is listening for messages from the background. The background script waits for a response from the content script and relays that message back to the panel.</p>

<p>Here’s a basic of example of how that works:</p>

<pre><code class="language-javascript">// Open up a connection to the background script
const portToBackgroundScript = browser.runtime.connect();

// Send message to content (via background)
portToBackgroundScript.postMessage("Hello from panel!");

// Listen for messages from content (via background)
portToBackgroundScript.onMessage.addListener((msg) => {
  console.log(msg);
  // => "Hello from content!"
});
</code></pre>

<pre><code class="language-javascript">// backrgound.js

// Open up a connection to the panel script
browser.runtime.onConnect.addListener((port) => {
  
  // Listen for messages from panel
  port.onMessage.addListener((request) => {
  
    // Send message from panel.js -> content.js
    // and return response from content.js -> panel.js
    browser.tabs.sendMessage(request.tabId, request)
      .then((res) => port.postMessage(res));
  });
});
</code></pre>

<pre><code class="language-javascript">// content.js

// Listen for messages from background
browser.runtime.onMessage.addListener((msg) => {

  console.log(msg)
  // => "Hello from panel!"
  
  // Send message to panel
  return Promise.resolve("Hello from content!");
});
</code></pre>

<h4 id="managing-feature-queries">Managing Feature Queries</h4>

<p>Lastly, we can get to the core of what the extension does, which is to “toggle” on/off the CSS related to a feature query.</p>

<p>If you recall, in the content script, we looped through all the CSS within feature queries. When we do this, we also need to save certain information about the CSS rule:</p>

<ol>
<li>The rule itself</li>
<li>The stylesheet it belongs to</li>
<li>The index of the rule within the stylesheet</li>
<li>An “inverted” version of the rule.</li>
</ol>

<p>This is what that looks like:</p>

<pre><code class="language-javascript">cssRules.forEach((rule, i) => {
  
  const cssRule = rule.cssText.substring(rule.cssText.indexOf("{"));
  const invertedCSSText = `@supports not ( ${ rule.conditionText } ) ${ cssRule }`;
  
  FEATURE_QUERY_DECLARATIONS.push({ 
    rule: rule,
    stylesheet: stylesheet,
    index: i, 
    invertedCSSText: invertedCSSText
  });
  
});
</code></pre>

<p>When the content script receives a message from the panel to invert all declarations relating to the feature query condition, we can easily replace the current rule with the inverted one (or vice versa).</p>

<pre><code class="language-javascript">function toggleCondition(condition, toggleOn) {
  FEATURE_QUERY_DECLARATIONS.forEach((declaration) => {
    if (declaration.rule.conditionText === condition) {
      
      // Remove current rule
      declaration.stylesheet.deleteRule(declaration.index);
      
      // Replace at index with either original or inverted declaration
      const rule = toggleOn ? declaration.rule.cssText : declaration.invertedCSSText;
      declaration.stylesheet.insertRule(rule, declaration.index);
    }    
  });
}
</code></pre>

<p>And that is essentially it! The  extension is currently available for Chrome and Firefox.</p>

<h3 id="limitations-of-the-fqm">Limitations Of The FQM</h3>

<p>The Feature Queries Manager works by “inverting” your feature queries, so that the opposite condition applies. This means that it cannot be used in every scenario.</p>

<h4 id="fallbacks">Fallbacks</h4>

<p>If your “enhancement” CSS is not written within a feature query, then the extension cannot be used as it is dependent on finding a CSS supports rule.</p>

<h4 id="unsupported-features">Unsupported Features</h4>

<p>You need to take note of if the browser you are using the FQM in does or does not support the feature in question. This is particularly important if your original feature query is a negative condition, as inverting it will turn it into a positive condition. For example, if you wrote the following CSS:</p>

<pre><code class="language-css">div { background-color: blue; }

@supports not (display: grid) {
  div { background-color: pink; }
}
</code></pre>

<p>If you use the FQM to invert this condition, it will become the following:</p>

<pre><code class="language-css">div { background-color: blue; }

@supports (display: grid) {
  div { background-color: pink; }
}
</code></pre>

<p>For you to be able to actually see the difference, you would need to be using a browser which does in fact support <code>display: grid</code>.</p>

<p><em>I built the Feature Queries Manager as a way to more easily test the different CSS as I develop, but it isn’t a replacement for testing layout in the actual browsers and devices. Developer tools only go so far, nothing beats real device testing.</em></p>




<div class="signature">
  <img src="https://www.smashingmagazine.com/images/logo/logo--red.png" alt="Smashing Editorial">
  <span>(ra, yk, il)</span>
</div>


</div>




  <div id="sponsors-article-end" data-impression="true" class="c-promo-box c-promo-box--ad c-promo-box--wide sponsors hidden" data-audience="non-subscriber" data-remove="true"></div>



              </article>
            </body>
          </html>
---------------